<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Migration to Google.Cloud.Spanner.Data 2.0 | Google.Cloud.Spanner.Data </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Migration to Google.Cloud.Spanner.Data 2.0 | Google.Cloud.Spanner.Data ">
    <meta name="generator" content="docfx 2.39.1.0">
    
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="stylesheet" href="styles/docfx.vendor.css">
    <link rel="stylesheet" href="styles/docfx.css">
    <link rel="stylesheet" href="styles/main.css">
    <meta property="docfx:navrel" content="toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="index.html">
                <img id="logo" class="svg" src="logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="migration-to-googlecloudspannerdata-20">Migration to Google.Cloud.Spanner.Data 2.0</h1>

<p>Google.Cloud.Spanner.Data version 2.0 includes a number of breaking
changes compared with version 1.0. We expect that most users will
not be affected by these changes, particularly when default settings
are used. For users who are affected, this document should help you
to migrate your application to the 2.0 version of the libraries.</p>
<p>If you have any problems with the breaking changes and they&#39;re not
covered in this document, please <a href="https://github.com/googleapis/google-cloud-dotnet/issues/new">file an
issue</a>
so we can help you further.</p>
<h2 id="configuration-changes">Configuration changes</h2>
<ul>
<li><code>SpannerOptions</code> has been removed completely. See the <a href="configuration.html">configuration
guide</a> for more details, but for migration
purposes:<ul>
<li><code>KeepAliveInterval</code> is replaced by <code>SessionPoolOptions.IdleSessionRefreshDelay</code></li>
<li><code>MaximumPooledSessions</code> has no direct equivalent in 2.0; once a session
is part of the pool, it will be refreshed as necessary until it is evicted.</li>
<li><code>MaximumActiveSessions</code> is now only present in <code>SessionPoolOptions</code></li>
<li><code>MaximumGrpcChannels</code> is specified in the connection string</li>
<li><code>LogLevel</code> is controlled on a per-logger basis; this property on
<code>SpannerOptions</code> was equivalent to changing
<code>Logger.DefaultLogger.LogLevel</code>.</li>
<li><code>PoolEvictionDelay</code> is now only present in <code>SessionPoolOptions</code></li>
<li><code>ResourcesExhaustedBehavior</code> has moved to <code>SessionPoolOptions</code></li>
<li><code>Timeout</code> is specified in the connection string</li>
<li><code>MaximumConcurrentSessionCreates</code> is now only present in
<code>SessionPoolOptions</code></li>
</ul>
</li>
<li><code>ClientPool</code> has been removed in 2.0. Its functionality has largely
been replaced by <code>SessionPoolManager</code>. It is expected that the
default session pool manager will be appropriate for most use cases,
but you can associate a <code>SessionPoolManager</code> with the
<code>SpannerConnectionStringBuilder</code> used to build a connection for more
advanced situations.</li>
<li><code>ResourcesExhaustedBehavior</code> has moved to Google.Cloud.Spanner.V1,
as it is now configured in <code>SessionPoolOptions</code>.</li>
<li>Loggers are configured on a <code>SessionPoolManager</code> basis</li>
</ul>
<h2 id="breaking-changes-in-connection-command-and-transaction-types">Breaking changes in connection, command and transaction types</h2>
<ul>
<li>The <code>SpannerCommandTextBuilder(string)</code> constructor has been removed.
The equivalent functionality is available via the static
<code>SpannerCommandTextBuilder.FromCommandText</code> method.</li>
<li><code>SpannerTransaction.CommitAsync</code> returns a <code>Task&lt;DateTime&gt;</code> rather
than a <code>Task&lt;DateTime?&gt;</code>. The server will always return a commit
timestamp, so the task&#39;s result would never have been null in 1.0
anyway. Client code should be able to use the resulting
<code>Task&lt;DateTime&gt;</code> more easily in most cases.</li>
<li><code>SpannerConnection</code> and <code>SpannerConnectionStringBuilder</code> no longer
expose <code>GetCredentials</code> method. There is no direct equivalent in 2.0;
please file an issue if you rely on this functionality.</li>
<li><code>SpannerConnection.ClearPooledResourcesAsync</code> is replaced by
<code>SpannerConnection.ShutdownSessionPoolAsync</code>. After this is called,
no further sessions can be created with the associated session pool.
If you need to control sessions in a more fine-grained way (for
example, shutting down one session pool but then creating new
sessions) you can associate a new <code>SessionPoolManager</code> instance with the
<code>SpannerConnectionStringBuilder</code> used to build a connection. See
the <a href="configuration.html">configuration guide</a> for an example of this.</li>
<li><code>SpannerTransaction.CommitAsync</code> now accepts a cancellation token.
This defaults to <code>CancellationToken.None</code>, so existing source code
should still compile, but this is a binary-incompatible change.</li>
</ul>
<h2 id="miscellaneous-breaking-changes">Miscellaneous breaking changes</h2>
<ul>
<li><code>SpannerDbType.StructOf</code> has been replaced by
<code>SpannerDbType.ForStruct</code>, using the new <code>SpannerStruct</code> type.</li>
</ul>
<h2 id="breaking-changes-in-googlecloudspannerv1">Breaking changes in Google.Cloud.Spanner.V1</h2>
<p>Users of the ADO.NET implementation in Google.Cloud.Spanner.Data
will rarely need to directly refer to the types in
Google.Cloud.Spanner.V1, but some low-level users may wish to do so.</p>
<p>The previous <code>Google.Cloud.Spanner.V1.SessionPool</code> class has been
replaced by a completely new implementation, with a new API and some
changes to the corresponding <code>SessionPoolOptions</code> class. The new
<code>SessionPool</code> manages transactions as well as sessions, so the
<code>TransactionPool</code> class from 1.0 has been removed. <code>PooledSession</code>
instances are acquired from the session pool (and must be released
appropriately). These are automatically refreshed (and eventually
evicted) by the session pool.</p>
<p>The <code>ExecuteSqlStream</code> and <code>GetSqlStreamReader</code> methods on
<code>SpannerClient</code> have been removed, along with
<code>SpannerClientSettings.ExecuteSqlStreamSettings</code>. The
<code>SpannerClient.ExecuteStreamingSql</code> method is responsible for
executing SQL and returning the results in a stream;
the <code>PooledSession.ExecuteSqlStreamReader</code> method returns a
<code>ReliableStreamReader</code>.</p>
<h2 id="changes-in-googlecloudspannerv1internal">Changes in Google.Cloud.Spanner.V1.Internal</h2>
<p>The Google.Cloud.Spanner.V1 package exposes some types in the
Google.Cloud.Spanner.V1.Internal namespace, for use by
Google.Cloud.Spanner.Data. These types were not intended for
use by third-party code, so this document does not go into detail
around the changes in this namespace.</p>
<h2 id="execution-time-behavior-changes">Execution-time behavior changes</h2>
<ul>
<li>Null values are returned as <code>DBNull.Value</code> by default rather
than the CLR default value for the type. Array and struct elements
use a null value where feasible, but throw <code>InvalidCastException</code>
when requested to be converted to a non-nullable value type. The
1.0 behavior can be requested using the <code>UseClrDefaultForNull</code>
<a href="connection_string.html">connection string option</a>.</li>
<li><code>Hashtable</code> is no longer used as a default type for
struct values. It can still be specified explicitly.
The new default is <code>Dictionary&lt;string, object&gt;</code>.</li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
             
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="styles/docfx.js"></script>
    <script type="text/javascript" src="styles/main.js"></script>
  </body>
</html>
