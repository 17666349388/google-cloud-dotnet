<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Configuration | Google.Cloud.Logging.Log4Net </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Configuration | Google.Cloud.Logging.Log4Net ">
    <meta name="generator" content="docfx 2.50.0.0">
    
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="stylesheet" href="styles/docfx.vendor.css">
    <link rel="stylesheet" href="styles/docfx.css">
    <link rel="stylesheet" href="styles/main.css">
    <meta property="docfx:navrel" content="toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="index.html">
                <img id="logo" class="svg" src="logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="configuration">Configuration</h1>

<h2 id="example-use-in-a-console-app">Example use in a console app</h2>
<p>Create an appender with the following XML configuration:</p>
<pre><code class="lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;log4net&gt;
  &lt;appender name=&quot;CloudLogger&quot; type=&quot;Google.Cloud.Logging.Log4Net.GoogleStackdriverAppender,Google.Cloud.Logging.Log4Net&quot;&gt;
    &lt;layout type=&quot;log4net.Layout.PatternLayout&quot;&gt;
      &lt;conversionPattern value=&quot;%-4timestamp [%thread] %-5level %logger %ndc - %message&quot; /&gt;
    &lt;/layout&gt;
    &lt;projectId value=&quot;PROJECT_ID&quot; /&gt;
    &lt;logId value=&quot;LOG_ID&quot; /&gt;
  &lt;/appender&gt;
  &lt;root&gt;
    &lt;level value=&quot;ALL&quot; /&gt;
    &lt;appender-ref ref=&quot;CloudLogger&quot; /&gt;
  &lt;/root&gt;
&lt;/log4net&gt;
</code></pre><p>Save this as <code>log4net.xml</code> in your application directory.
Then load it during program startup:</p>
<pre><code class="lang-csharp">using log4net;
using log4net.Config;

public static void Main(string[] args)
{
    XmlConfigurator.Configure(new FileInfo(&quot;log4net.xml&quot;));
}
</code></pre><p>Logged items will now be sent to Google Cloud Logging:</p>
<pre><code class="lang-csharp">using log4net;

ILog log = LogManager.GetLogger(typeof(Program));
log.Info(&quot;An exciting log entry!&quot;);
</code></pre><h2 id="custom-configuration">Custom configuration</h2>
<p>Within a <code>GoogleStackdriverAppender</code> the following options are
available (see also <a href="api/Google.Cloud.Logging.Log4Net.GoogleStackdriverAppender.html#properties">the GoogleStackdriverAppender reference documentation</a>
for more details):</p>
<h3 id="projectid">projectId</h3>
<pre><code class="lang-xml">&lt;projectId value=&quot;&lt;your project ID&gt;&quot;/&gt;
</code></pre><p>Optional when running on Google App Engine (GAE) or Google Compute Engine (GCE), must be present on other platforms. The project ID given must be the ID of a project that already exists on <a href="https://cloud.google.com/">Google Cloud Platform</a>.</p>
<p>On GCE and GAE the project ID will be auto-detected from the platform.</p>
<h3 id="logid">logId</h3>
<pre><code class="lang-xml">&lt;logId value=&quot;&lt;your log ID&gt;&quot;/&gt;
</code></pre><p>Must be present. The log ID given is any string that is recorded as the name of the log, which can be used for simple filtering when viewing log entries.</p>
<h3 id="withmetadata">withMetaData</h3>
<pre><code class="lang-xml">&lt;withMetaData value=&quot;&lt;various, see below&gt;&quot;/&gt;
</code></pre><p>By default no extra metadata is logged. <code>withMetaData</code> specifies which extra metadata to log with each log entry, and can be specified multiple times to enable multiple type of metadata:</p>
<ul>
<li><code>Location</code>: The class name, file name, and line number of the log call.</li>
<li><code>Identity</code>: The identity of the current thread principle.</li>
<li><code>ThreadName</code>: The name of the thread that performed the log call.</li>
<li><code>UserName</code>: The name of the current user.</li>
<li><code>Domain</code>: The AppDomain friendly name.</li>
<li><code>LoggerName</code>: The name of the log4net logger that created this log entry.</li>
<li><code>Label</code>: The name of the log4net logging level that caused this log entry (e.g. &quot;FATAL&quot;)</li>
</ul>
<h3 id="customlabel">customLabel</h3>
<pre><code class="lang-xml">&lt;customLabel&gt;
  &lt;key value=&quot;&lt;your key&gt;&quot; /&gt;
  &lt;value value=&quot;&lt;your value&gt;&quot; /&gt;
&lt;/customLabel&gt;
</code></pre><p>Allows custom labels to be added to the metadata of log entries.</p>
<h3 id="usepatternwithincustomlabels">UsePatternWithinCustomLabels</h3>
<pre><code class="lang-xml">&lt;usePatternWithinCustomLabels value=&quot;true&quot;/&gt;
</code></pre><p>Defaults to <code>false</code>. Setting this to <code>true</code> enables <code>PatternLayout</code> use in custom labels.
All the standard patterns documented for Log4Net <code>PatternLayout</code> are available.
Custom pattern conversions are not possible.</p>
<h3 id="resourcetype">resourceType</h3>
<pre><code class="lang-xml">&lt;resourceType value=&quot;&lt;your resource type&gt;&quot;/&gt;
</code></pre><p>Allows the <a href="https://cloud.google.com/logging/docs/reference/v2/rest/v2/MonitoredResource">Monitored resources</a> resource type to be specified; must be set to an entry on the <a href="https://cloud.google.com/logging/docs/api/v2/resource-list">Monitored Resource List</a>.</p>
<p>If unset, the default value depends on the detected platform:</p>
<ul>
<li><code>gae_app</code> on Google App Engine (GAE).</li>
<li><code>gce_instance</code> on Google Compute Engine (GCE).</li>
<li><code>global</code> on all other platforms.</li>
</ul>
<p>(See <a href="https://github.com/googleapis/gax-dotnet/blob/master/src/Google.Api.Gax.Grpc/MonitoredResourceBuilder.cs">MonitoredResourceBuilder.cs</a> for details)</p>
<h3 id="resourcelabel">resourceLabel</h3>
<pre><code class="lang-xml">&lt;resourceLabel&gt;
  &lt;key value=&quot;&lt;key&gt;&quot; /&gt;
  &lt;value value=&quot;&lt;value&gt;&quot; /&gt;
&lt;/resourceLabel&gt;
</code></pre><p>If <code>resourceType</code> has been manually set, then <code>resourceLabel</code> is used to specify extra labels as shown in the <a href="https://cloud.google.com/logging/docs/api/v2/resource-list#resource-types">Monitoring Resource Types</a> list.</p>
<h3 id="disableresourcetypedetection">DisableResourceTypeDetection</h3>
<pre><code class="lang-xml">&lt;disableResourceTypeDetection value=&quot;true&quot;&gt;
</code></pre><p>Defaults to <code>false</code>. Setting this to <code>true</code> disables automatic <code>resourceType</code> setting based on platform detection.</p>
<h3 id="complete-configuration-example">Complete configuration example</h3>
<p>So, for example, a complete configuration might look like this:</p>
<pre><code class="lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;log4net&gt;
  &lt;appender name=&quot;CloudLogger&quot; type=&quot;Google.Cloud.Logging.Log4Net.GoogleStackdriverAppender,Google.Cloud.Logging.Log4Net&quot;&gt;
    &lt;layout type=&quot;log4net.Layout.PatternLayout&quot;&gt;
      &lt;conversionPattern value=&quot;%-4timestamp [%thread] %-5level %logger %ndc - %message&quot; /&gt;
    &lt;/layout&gt;
    &lt;projectId value=&quot;myProject&quot; /&gt;
    &lt;logId value=&quot;myLog&quot; /&gt;
    &lt;withMetaData value=&quot;Location&quot; /&gt;
    &lt;withMetaData value=&quot;ThreadName&quot; /&gt;
  &lt;/appender&gt;
&lt;/log4net&gt;
</code></pre><h3 id="configuration-example-translating-log4net-properties-to-google-cloud-logging-labels">Configuration example: Translating Log4Net properties to Google Cloud Logging labels</h3>
<p>If you wanted to transalate Log4Net properties to Google Cloud Logging labels, you can do as follows:</p>
<p>Create a <code>log4net</code> configuration file (<code>log4net.xml</code>):</p>
<pre><code class="lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;
&lt;log4net&gt;
  &lt;appender name=&quot;CloudLogger&quot; type=&quot;Google.Cloud.Logging.Log4Net.GoogleStackdriverAppender,Google.Cloud.Logging.Log4Net&quot;&gt;
    &lt;layout type=&quot;log4net.Layout.PatternLayout&quot;&gt;
      &lt;conversionPattern value=&quot;%-4timestamp [%thread] %-5level %logger %ndc - %message&quot; /&gt;
    &lt;/layout&gt;
    &lt;projectId value=&quot;PROJECT_ID&quot; /&gt;
    &lt;logId value=&quot;LOG_ID&quot; /&gt;
    &lt;usePatternWithinCustomLabels value=&quot;true&quot;/&gt;
    &lt;customLabel&gt;
      &lt;key value=&quot;label_from_property&quot; /&gt;
      &lt;value value=&quot;%property{property_for_label}&quot; /&gt;
    &lt;/customLabel&gt;
  &lt;/appender&gt;
  &lt;root&gt;
    &lt;level value=&quot;ALL&quot; /&gt;
    &lt;appender-ref ref=&quot;CloudLogger&quot; /&gt;
  &lt;/root&gt;
&lt;/log4net&gt;
</code></pre><p>Edit the file replacing <code>PROJECT_ID</code> with your Google Cloud Project
ID, and <code>LOG_ID</code> with an identifier for your application.</p>
<p>Use this file to configure <code>log4net</code> and then set Log4Net properties per scopes and log as normal.
If a property referenced in a custom label doesn&#39;t have a value for a given entry, the value will be
<code>(null)</code>.</p>
<pre><code class="lang-cs">// Configure log4net to use Google Cloud Logging from the XML configuration file.
XmlConfigurator.Configure(LogManager.GetRepository(GetType().Assembly), new FileInfo(&quot;log4net.xml&quot;));

// Retrieve a logger for this context.
ILog log = LogManager.GetLogger(typeof(Program));
// Set a property using one of the GlobaContext, ThreadContext or LogicalThreadContext classes.
LogicalThreadContext.Properties[&quot;property_for_label&quot;] = &quot;my label value&quot;;
// Log some information. This log entry will be sent to Google Cloud Logging with a label
// {&quot;label_from_property&quot;, &quot;my label value&quot;}. The label key &quot;label_from_property&quot; is the one
// specified in configuration for a custom label that gets its value from the &quot;property_for_label&quot;
// property.
log.Info(&quot;An exciting log entry!&quot;);

// Flush buffered log entries before program exit.
// This is required because log entries are buffered locally before being sent to Google Cloud Logging.
// LogManager.Flush() only works in the full .NET framework (not in .NET Core):
bool flushCompleted = LogManager.Flush(10_000);
// On .NET Core, the specific repository needs to be flushed:
bool repositoryFlushCompleted = ((IFlushable)LogManager.GetRepository(GetType().Assembly)).Flush(10_000);
</code></pre><p>If executing on <a href="https://cloud.google.com/appengine/">Google App Engine (GAE)</a>,
<a href="https://cloud.google.com/kubernetes-engine/">Google Kubernetes Engine (GKE)</a>,
or <a href="https://cloud.google.com/compute/">Google Compute Engine (GCE)</a>,
then the <code>&lt;projectId value=&quot;PROJECT_ID&quot; /&gt;</code> configuration setting can be omitted; it will be auto-detected from the platform at run-time.</p>
<h2 id="local-queuing-configuration">Local queuing configuration</h2>
<p>All log entries are queued locally before being sent to Google Cloud Logging.
Only in-memory queuing is currently supported. Persistent on-disk queuing is not currently implemented.</p>
<p>The following in-memory options are available:</p>
<pre><code class="lang-xml">&lt;MaxMemorySize value=&quot;&lt;maximum number of bytes to queue&gt;&quot;/&gt;
</code></pre><p>Restricts the amount of memory used for local queuing. If memory is exceeded then the 
oldest log entries will be discarded. A best-effort attempt will be made to log a warning
to Google Cloud Logging that some log messages have been discarded.
A value of 0 means there is no byte limit.</p>
<pre><code class="lang-xml">&lt;MaxMemoryCount value=&quot;&lt;maximum count of log messages to queue&quot;/&gt;
</code></pre><p>The maximum count of log messages that be ever be concurrently locally queued. If this
maximum count is exceeded then the oldest log entries will be discarded. A best-effort
attempt will be made to log a warning to Google Cloud Logging that some log messages
have been discarded.
A value of 0 means there is no count limit.</p>
<p>If MaxMemorySize and MaxMemoryCount are both specified, then messages will be discarded
when the first limit is reached.</p>
<p>The default setting is to limit count to 1,000; with no limit on bytes.</p>
<h2 id="providing-a-json-payload">Providing a JSON payload</h2>
<p>Log entries in Google Cloud Logging either have a text payload or a
JSON payload. By default, the
<code>Google.Cloud.Logging.Log4Net.GoogleStackdriverAppender</code> uses a text
payload. However, you can implement the
<a href="api/Google.Cloud.Logging.Log4Net.IJsonLayout.html">IJsonLayout</a> interface and configure
the appender to use that. The JSON payload is expressed as a
Protocol Buffers <code>Struct</code> message. If the <code>IJsonLayout.Format</code>
method returns null from your layout, the appender will create a
text payload as normal.</p>
<p>For example, here&#39;s a sample JSON layout implementation that
demonstrates creating a payload with a mixture of values from
execution time (the event message and exception) and from
configuration (the &quot;SampleConfiguration&quot; value).</p>
<pre><code class="lang-cs">public class SampleJsonLayout : IJsonLayout, IOptionHandler
{
    public Struct _template;

    public int SampleConfigurationValue { get; set; }

    public void ActivateOptions()
    {
        _template = new Struct();
        _template.Fields[&quot;SampleConfiguration&quot;] = Value.ForNumber(SampleConfigurationValue);
    }

    public Struct Format(LoggingEvent loggingEvent)
    {
        Struct ret = _template.Clone();
        ret.Fields[&quot;Message&quot;] = Value.ForString(loggingEvent.RenderedMessage);
        if (loggingEvent.ExceptionObject != null)
        {
            ret.Fields[&quot;Exception&quot;] = Value.ForString(loggingEvent.ExceptionObject.Message);
        }
        return ret;
    }
}
</code></pre><p>You would then configure the appender in XML like this:</p>
<pre><code class="lang-xml">&lt;appender name=&quot;CloudLogger&quot; type=&quot;Google.Cloud.Logging.Log4Net.GoogleStackdriverAppender,Google.Cloud.Logging.Log4Net&quot;&gt;
  &lt;!-- The IJsonLayout implementation used to create JSON payloads --&gt;  
  &lt;jsonLayout type=&quot;YourNamespace.SampleJsonLayout,YourAssemblyName&quot;&gt;
    &lt;sampleConfigurationValue value=&quot;10&quot; /&gt;
  &lt;/jsonLayout&gt;

  &lt;!-- 
    - Other configuration as normal. The textlayout is used if the
    -  JSON layout returns null.
    --&gt;

  &lt;layout type=&quot;log4net.Layout.PatternLayout&quot;&gt;
    &lt;conversionPattern value=&quot;%-4timestamp [%thread] %-5level %logger %ndc - %message&quot; /&gt;
  &lt;/layout&gt;
  &lt;projectId value=&quot;PROJECT_ID&quot; /&gt;
  &lt;logId value=&quot;LOG_ID&quot; /&gt;
&lt;/appender&gt;
</code></pre><h2 id="feedback">Feedback...</h2>
<p>Please file <a href="https://github.com/googleapis/google-cloud-dotnet/issues">GitHub issues</a> for bugs or questions.</p>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
             
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="styles/docfx.js"></script>
    <script type="text/javascript" src="styles/main.js"></script>
  </body>
</html>
