<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Call settings | Google Cloud APIs </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Call settings | Google Cloud APIs ">
    <meta name="generator" content="docfx 2.50.0.0">
    
    <link rel="shortcut icon" href="../favicon.ico">
    <link rel="stylesheet" href="../styles/docfx.vendor.css">
    <link rel="stylesheet" href="../styles/docfx.css">
    <link rel="stylesheet" href="../styles/main.css">
    <meta property="docfx:navrel" content="../toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="../index.html">
                <img id="logo" class="svg" src="../logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        
        <div class="sidenav hide-when-search">
          <a class="btn toc-toggle collapse" data-toggle="collapse" href="#sidetoggle" aria-expanded="false" aria-controls="sidetoggle">Show / Hide Table of Contents</a>
          <div class="sidetoggle collapse" id="sidetoggle">
            <div id="sidetoc"></div>
          </div>
        </div>
        <div class="article row grid-right">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="call-settings">Call settings</h1>

<h2 id="introduction">Introduction</h2>
<p>All client libraries wrapping gRPC-based APIs (see the <a href="api-layers.html">API layers</a> article)
allow customization of RPC calls by using
<a href="../api/Google.Api.Gax.Grpc.CallSettings.html">CallSettings</a>. If <code>CallSettings</code> are
not specified sensible defaults are automatically provided.
See the <a href="../api/Google.Api.Gax.Grpc.CallSettings.html">CallSettings documentation</a>
for descriptions of the available properties.</p>
<p>The underlying gRPC API uses
<a href="http://www.grpc.io/grpc/csharp/html/T_Grpc_Core_CallOptions.htm">CallOptions</a>,
which provides a slightly reduced feature set compared to <code>CallSettings</code>.
Client libraries automatically construct a <code>CallOptions</code> from <code>CallSettings</code>
as required.</p>
<p>There are three distinct places where <code>CallSettings</code> may optionally be provided:</p>
<ul>
<li>When calling an RPC method <em>(highest priority)</em>.</li>
<li>Client-wide when creating a client object (for example, using
<a href="../Google.Cloud.PubSub.V1/api/Google.Cloud.PubSub.V1.PublisherServiceApiClient.html#Google_Cloud_PubSub_V1_PublisherServiceApiClient_Create_Google_Api_Gax_ServiceEndpoint_Google_Cloud_PubSub_V1_PublisherServiceApiSettings_">PublisherServiceApiClient.Create()</a>).</li>
<li>Per-RPC-method when creating a client object <em>(lowest priority)</em>.</li>
</ul>
<p>It&#39;s important to understand exactly which properties of which <code>CallSettings</code> will be used during an RPC invocation.
The three <code>CallSettings</code> objects are merged into a single effective <code>CallSettings</code>.
Each property is merged separately: the highest priority non-<code>null</code> value for each
property is used.</p>
<p>The client-wide <code>CallSettings</code> is higher-priority than per-RPC-method <code>CallSettings</code>
because it is often useful to be able to easily specify common properties to use
for all RPC invocations. For example, a common set of
<a href="../api/Google.Api.Gax.Grpc.CallSettings.html#Google_Api_Gax_Grpc_CallSettings_HeaderMutation">headers</a>;
or a common
<a href="../api/Google.Api.Gax.Grpc.CallSettings.html#Google_Api_Gax_Grpc_CallSettings_Expiration">expiration (deadline)</a>
for multiple RPC invocations.</p>
<h2 id="examples">Examples</h2>
<h3 id="per-rpc-highest-priority">Per-RPC (highest priority)</h3>
<pre><code class="lang-cs">// Create a PublisherServiceApiClient with default settings.
PublisherServiceApiClient client = PublisherServiceApiClient.Create();
// Create a topic name from the projectId and topicId.
TopicName topicName = new TopicName(projectId, topicId);
// Create a CallSettings with a custom header.
CallSettings callSettings = CallSettings.FromHeader(&quot;ClientVersion&quot;, &quot;1.0.0&quot;);
// This will cause the custom &#39;ClientVersion&#39; header to be included in the RPC call.
Topic topic = client.CreateTopic(topicName, callSettings);
</code></pre><h3 id="client-configuration-client-wide">Client configuration; client-wide</h3>
<pre><code class="lang-cs">// Create a default PublisherServiceApiSettings, with a custom header for calls to all RPC methods.
PublisherServiceApiSettings publisherSettings = new PublisherServiceApiSettings
{
    CallSettings = CallSettings.FromHeader(&quot;ClientVersion&quot;, &quot;1.0.0&quot;)
};
PublisherServiceApiClient client = new PublisherServiceApiClientBuilder { Settings = publisherSettings }.Build();
// Create a topic name from the projectId and topicId.
TopicName topicName = new TopicName(projectId, topicId);
// The custom &#39;ClientVersion&#39; header will be included in the RPC call, due to
// the client being configured with &#39;publishersettings&#39; above.
Topic topic = client.CreateTopic(topicName);
</code></pre><h3 id="client-configuration-per-rpc-method-lowest-priority">Client configuration; per-RPC-method (lowest priority)</h3>
<pre><code class="lang-cs">// Create a default PublisherServiceApiSettings, with a custom header for calls
// to the CreateTopic RPC method.
PublisherServiceApiSettings publisherSettings = new PublisherServiceApiSettings();
publisherSettings.CreateTopicSettings = publisherSettings.CreateTopicSettings.WithHeader(&quot;ClientVersion&quot;, &quot;1.0.0&quot;);
PublisherServiceApiClient client = new PublisherServiceApiClientBuilder { Settings = publisherSettings }.Build();
// Create a topic name from the projectId and topicId.
TopicName topicName = new TopicName(projectId, topicId);
// The custom &#39;ClientVersion&#39; header will be included in the RPC call, due to
// the client being configured with &#39;publishersettings&#39; above.
Topic topic = client.CreateTopic(topicName);
</code></pre><h3 id="multiple-callsettings-specified">Multiple <code>Callsettings</code> specified</h3>
<pre><code class="lang-cs">// Create a default PublisherServiceApiSettings, with customizations for CreateTopic RPCs:
// * A custom &quot;ClientVersion&quot; header.
// * A custom 5-second timeout Timing.
// * No cancellation token.
PublisherServiceApiSettings publisherSettings = new PublisherServiceApiSettings();
publisherSettings.CreateTopicSettings = publisherSettings.CreateTopicSettings
    .WithCancellationToken(CancellationToken.None)
    .WithTimeout(TimeSpan.FromSeconds(5))
    .WithHeader(&quot;ClientVersion&quot;, &quot;1.0.0&quot;);

// Override the above Timing and CancellationToken in the client-wide CallSettings;
// the Headers are not overridden.
publisherSettings.CallSettings = CallSettings
    .FromExpiration(Expiration.FromDeadline(deadline))
    .WithCancellationToken(CancellationToken.None);

// Create the client with the configured publisherSettings
PublisherServiceApiClient client = new PublisherServiceApiClientBuilder { Settings = publisherSettings }.Build();

// Create a topic name from the projectId and topicId.
TopicName topicName = new TopicName(projectId, topicId);

// Call CreateTopic(). Override only the CancellationToken, using a per-RPC-method CallSettings.
// The CallSettings used during this RPC invocation is:
// * A custom &quot;ClientVersion&quot; header.
// * A Timing deadline of &#39;deadline&#39; (*not* the overridden 5-second timeout).
// * The CancellationToken &#39;cancellationToken&#39; (*not* CancellationToken.None).
Topic topic = client.CreateTopic(topicName, CallSettings.FromCancellationToken(cancellationToken));
</code></pre><h2 id="defaults">Defaults</h2>
<p>By default there is a per-RPC-method client configuration that specifies a sensible
retry policy for every method. See, for example,
<a href="../Google.Cloud.PubSub.V1/api/Google.Cloud.PubSub.V1.PublisherServiceApiSettings.html#Google_Cloud_PubSub_V1_PublisherServiceApiSettings_CreateTopicSettings">PublisherServiceApiSettings.CreateTopicSettings</a>.</p>
<h2 id="expiration">Expiration</h2>
<p>CallSettings has an <a href="../api/Google.Api.Gax.Grpc.CallSettings.html#Google_Api_Gax_Grpc_CallSettings_Expiration">Expiration</a> property,
of type <a href="../api/Google.Api.Gax.Expiration.html">Expiration</a> which defines when an operation will fail due to timing out.
This can be either a <em>timeout</em> (relative to the start time, e.g. &quot;it can&#39;t take more than 5 seconds&quot;) or a <em>deadline</em> (which is
absolute, e.g. &quot;it must finish by 2016-12-07 14:55:00Z&quot;). You create an <code>Expiration</code> by specifying that timeout
or deadline, with the <a href="../api/Google.Api.Gax.Expiration.html#Google_Api_Gax_Expiration_FromTimeout_System_TimeSpan_">Expiration.FromTimeout(TimeSpan)</a>
and <a href="../api/Google.Api.Gax.Expiration.html#Google_Api_Gax_Expiration_FromDeadline_System_DateTime_">Expiration.FromDeadline(DateTime)</a> methods.
Alternatively, you can use <a href="../api/Google.Api.Gax.Expiration.html#Google_Api_Gax_Expiration_None">Expiration.None</a>, which is an infinite timeout.</p>
<p>A timeout is always relative to the
start of an operation, not the time the expiration is created. So for example, if you create an expiration of
5 seconds, you can use that as often as you like, and it will always mean that the operation you&#39;re applying
the expiration to has 5 seconds to complete.</p>
<p>Note that deadline expirations are most commonly used when the same deadline is passed to multiple calls:
if you have to perform 5 different operations, and you know your total work needs to finish at a particular
point but you don&#39;t care how those 5 operations use up your time budget between them, passing in the same
deadline to all 5 works well. This is restricted to one unit of work, however - you&#39;d need to calculate a new
deadline for the next unit of work, whereas a relative timeout may be valid for all calls. You should think
carefully about your own requirements - and please file a feature request if we don&#39;t provide enough functionality
for you to meet them.</p>
<p>Note that the expiration applies to the operation as a whole. This might involve making multiple RPCs, due to retry
which is discussed below.</p>
<h3 id="retry">Retry</h3>
<p>The client libraries can transparently retry operations if it is deemed safe to do so (typically read operations),
based on the <a href="../api/Google.Api.Gax.Grpc.CallSettings.html#Google_Api_Gax_Grpc_CallSettings_Retry">CallSettings.Retry</a> property,
of type <a href="../api/Google.Api.Gax.Grpc.RetrySettings.html">RetrySettings</a>.</p>
<p>RetrySettings configure three aspects of retry:</p>
<ul>
<li>When retry can be attempted, which is conditional on the exception thrown by a failed attempt</li>
<li>A maximum number of attempts to perform</li>
<li>How long to wait between retries (the backoff)</li>
</ul>
<p>The first two of these, represented by the <code>RetryFilter</code>
and <code>MaxAttempts</code> properties, are reasonably simple.</p>
<p>The backoff between retries is more complex. It consists of:</p>
<ul>
<li>An initial backoff to be used after the first attempt</li>
<li>A multiplier for the backoff (e.g. 2.0 to double the backoff each time, or 1.0 for a constant backoff)</li>
<li>A maximum backoff</li>
<li>A jitter to apply to each backoff to determine the actual amount of time to delay. This avoids multiple client
accidentally synchronizing their retries and periodically hitting
a service very hard. This is exposed for testability, but is unlikely to need tweaking in production use.</li>
</ul>
<p><code>RetrySettings</code> instances are created through two factory methods:</p>
<ul>
<li><a href="../api/Google.Api.Gax.Grpc.RetrySettings.html#Google_Api_Gax_Grpc_RetrySettings_FromConstantBackoff_System_Int32_System_TimeSpan_System_Predicate_System_Exception__Google_Api_Gax_Grpc_RetrySettings_IJitter_">RetrySettings.FromConstantBackoff</a> which uses a multiplier of 1 and no maximum (because it&#39;s constant)</li>
<li><a href="../api/Google.Api.Gax.Grpc.RetrySettings.html#Google_Api_Gax_Grpc_RetrySettings_FromExponentialBackoff_System_Int32_System_TimeSpan_System_TimeSpan_System_Double_System_Predicate_System_Exception__Google_Api_Gax_Grpc_RetrySettings_IJitter_">RetrySettings.FromExponentialBackoff</a> which allows every aspect to be specified</li>
</ul>
</article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
             
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="../styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="../styles/docfx.js"></script>
    <script type="text/javascript" src="../styles/main.js"></script>
  </body>
</html>
