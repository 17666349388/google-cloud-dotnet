<!DOCTYPE html>
<!--[if IE]><![endif]-->
<html>
  
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>Google.Cloud.Diagnostics.AspNet | Google.Cloud.Diagnostics.AspNet </title>
    <meta name="viewport" content="width=device-width">
    <meta name="title" content="Google.Cloud.Diagnostics.AspNet | Google.Cloud.Diagnostics.AspNet ">
    <meta name="generator" content="docfx 2.39.1.0">
    
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="stylesheet" href="styles/docfx.vendor.css">
    <link rel="stylesheet" href="styles/docfx.css">
    <link rel="stylesheet" href="styles/main.css">
    <meta property="docfx:navrel" content="toc.html">
    <meta property="docfx:tocrel" content="toc.html">
    
    
    
  </head>
  <body data-spy="scroll" data-target="#affix" data-offset="120">
    <div id="wrapper">
      <header>
        
        <nav id="autocollapse" class="navbar navbar-inverse ng-scope" role="navigation">
          <div class="container">
            <div class="navbar-header">
              <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              
              <a class="navbar-brand" href="index.html">
                <img id="logo" class="svg" src="logo.svg" alt="">
              </a>
            </div>
            <div class="collapse navbar-collapse" id="navbar">
              <form class="navbar-form navbar-right" role="search" id="search">
                <div class="form-group">
                  <input type="text" class="form-control" id="search-query" placeholder="Search" autocomplete="off">
                </div>
              </form>
            </div>
          </div>
        </nav>
        
        <div class="subnav navbar navbar-default">
          <div class="container hide-when-search" id="breadcrumb">
            <ul class="breadcrumb">
              <li></li>
            </ul>
          </div>
        </div>
      </header>
      <div role="main" class="container body-content hide-when-search">
        <div class="article row grid">
          <div class="col-md-10">
            <article class="content wrap" id="_content" data-uid="">
<h1 id="googleclouddiagnosticsaspnet">Google.Cloud.Diagnostics.AspNet</h1>

<p><code>Google.Cloud.Diagnostics.AspNet</code> is an ASP.NET instrumentation library for Google Stackdriver.
It allows for simple integration of Stackdriver into ASP.NET applications with minimal code changes.</p>
<p><code>Google.Cloud.Diagnostics.AspNet</code> currently supports Stackdriver Error Reporting and Stackdriver Trace.</p>
<p>Note:
This documentation is for version <code>3.0.0-beta11</code> of the library.
Some samples may not work with other versions.</p>
<h1 id="installation">Installation</h1>
<p>Install the <code>Google.Cloud.Diagnostics.AspNet</code> package from NuGet. Add it to
your project in the normal way (for example by right-clicking on the
project in Visual Studio and choosing &quot;Manage NuGet Packages...&quot;).
Please ensure you enable pre-release packages (for example, in the
Visual Studio NuGet user interface, check the &quot;Include prerelease&quot;
box). Some of the following samples might only work with the latest 
pre-release version (<code>3.0.0-beta11</code>) of <code>Google.Cloud.Diagnostics.AspNet</code>.</p>
<h1 id="authentication">Authentication</h1>
<p>When running on Google Cloud Platform, no action needs to be taken to authenticate.</p>
<p>Otherwise, the simplest way of authenticating your API calls is to
download a service account JSON file then set the <code>GOOGLE_APPLICATION_CREDENTIALS</code> environment variable to refer to it.
The credentials will automatically be used to authenticate. See the <a href="https://cloud.google.com/docs/authentication/getting-started">Getting Started With
Authentication</a> guide for more details.</p>
<h1 id="note">Note</h1>
<p>The Google.Cloud.Diagnostics.AspNet package attempts to collect the filename and line number when
entries are collected.  However, to be able to collect this information PDBs must be included with
the deployed code.</p>
<h1 id="getting-started">Getting started</h1>
<h2 id="registering-error-reporting-web-api">Registering Error Reporting (Web Api)</h2>
<pre><code class="lang-cs">private static void Register(HttpConfiguration config)
{
    // Add a catch all for the uncaught exceptions.
    // Replace ProjectId with your Google Cloud Project ID.
    // Replace Service with a name or identifier for the service.
    // Replace Version with a version for the service.
    config.Services.Add(typeof(System.Web.Http.ExceptionHandling.IExceptionLogger),
        ErrorReportingExceptionLogger.Create(ProjectId, Service, Version));

    // Any other actions your app might need.

    // Web API routes
    config.MapHttpAttributeRoutes();

    config.Routes.MapHttpRoute(
        name: &quot;DefaultApi&quot;,
        routeTemplate: &quot;api/{controller}/{action}/{id}&quot;,
        defaults: new { id = RouteParameter.Optional }
    );
}
</code></pre><h2 id="log-exceptions-web-api">Log Exceptions (Web Api)</h2>
<pre><code class="lang-cs">public class HomeController : ApiController
{
    // On this sample, we explicitly create an instance of the Web Api specific
    // GoogleWebApiExceptionLogger.
    // This is a dependency that you will probably want to inject
    // using the dependency injection mechanism of your choice.
    IWebApiExceptionLogger exceptionLogger = GoogleWebApiExceptionLogger.Create(
        // Replace ProjectId with your Google Cloud Project ID.
        // Replace Service with a name or identifier for the service.
        // Replace Version with a version for the service.
        ProjectId, Service, Version);

    /// &lt;summary&gt;This action method catches and logs an &lt;see cref=&quot;Exception&quot;/&gt; using the
    /// Web Api specific &lt;see cref=&quot;GoogleWebApiExceptionLogger&quot;&gt;&lt;/summary&gt;
    [HttpGet]
    public string CatchesAndLogsExceptions(string id)
    {
        try
        {
            // Do something which happens to throw an Exception
            DoSomething(id);
        }
        catch (Exception e)
        {
            exceptionLogger.Log(e, ActionContext);
        }
        return &quot;Something done succesfully.&quot;;
    }

    // This is normally not required, but ensures that &quot;DoSomething&quot; is in the stack
    // trace. The method is otherwise inlined by the JIT compiler for release builds in
    // some environments.
    [MethodImpl(MethodImplOptions.NoInlining)]
    private void DoSomething(string id)
    {
        throw new Exception(id);
    }
}
</code></pre><h2 id="registering-error-reporting-mvc">Registering Error Reporting (MVC)</h2>
<pre><code class="lang-cs">public static void RegisterGlobalFilters(GlobalFilterCollection filters)
{
    string projectId = &quot;[Google Cloud Platform project ID]&quot;;
    string serviceName = &quot;[Name of service]&quot;;
    string version = &quot;[Version of service]&quot;;
    // Add a catch all for the uncaught exceptions.
    filters.Add(ErrorReportingExceptionFilter.Create(projectId, serviceName, version));
}
</code></pre><h2 id="log-exceptions-mvc">Log Exceptions (MVC)</h2>
<pre><code class="lang-cs">string projectId = &quot;[Google Cloud Platform project ID]&quot;;
string serviceName = &quot;[Name of service]&quot;;
string version = &quot;[Version of service]&quot;;
var exceptionLogger = GoogleExceptionLogger.Create(projectId, serviceName, version);

try
{
    string scores = File.ReadAllText(@&quot;C:\Scores.txt&quot;);
    Console.WriteLine(scores);
}
catch (IOException e)
{
    exceptionLogger.Log(e);
}
</code></pre><h2 id="initializing-tracing">Initializing Tracing</h2>
<pre><code class="lang-cs">public class Global : HttpApplication
{
    public override void Init()
    {
        base.Init();
        string projectId = &quot;[Google Cloud Platform project ID]&quot;;
        // Trace a sampling of incoming Http requests.
        CloudTrace.Initialize(this, projectId);
    }
}
</code></pre><h2 id="trace-outgoing-http-requests">Trace Outgoing HTTP Requests</h2>
<pre><code class="lang-cs">// Add a handler to trace outgoing requests and to propagate the trace header.
var traceHeaderHandler = CloudTrace.CreateTracingHttpMessageHandler();
using (var httpClient = new HttpClient(traceHeaderHandler))
{
    return await httpClient.GetAsync(&quot;https://weather.com/&quot;);
}
</code></pre><h2 id="manual-tracing">Manual Tracing</h2>
<pre><code class="lang-cs">// Manually trace a specific operation.
using (CloudTrace.Tracer.StartSpan(&quot;hello-world&quot;))
{
    Console.Out.WriteLine(&quot;Hello, World!&quot;);
}
</code></pre><pre><code class="lang-cs">// Manually trace a specific Action or Func&lt;T&gt;.
CloudTrace.Tracer.RunInSpan(
    () =&gt; Console.Out.WriteLine(&quot;Hello, World!&quot;),
    &quot;hello-world&quot;);
</code></pre></article>
          </div>
          
          <div class="hidden-sm col-md-2" role="complementary">
            <div class="sideaffix">
              <nav class="bs-docs-sidebar hidden-print hidden-xs hidden-sm affix" id="affix">
              <!-- <p><a class="back-to-top" href="#top">Back to top</a><p> -->
              </nav>
            </div>
          </div>
        </div>
      </div>
      
      <footer>
        <div class="grad-bottom"></div>
        <div class="footer">
          <div class="container">
            <span class="pull-right">
              <a href="#top">Back to top</a>
            </span>
             
            
          </div>
        </div>
      </footer>
    </div>
    
    <script type="text/javascript" src="styles/docfx.vendor.js"></script>
    <script type="text/javascript" src="styles/docfx.js"></script>
    <script type="text/javascript" src="styles/main.js"></script>
  </body>
</html>
